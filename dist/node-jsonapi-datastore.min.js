!function(){"use strict";function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),e=function(){function e(i,n){t(this,e),this.id=n,this._type=i,this._attributes=[],this._relationships=[],this._references=[],this._protectedAttributes={},this._protectedRelationships={}}return i(e,[{key:"serialize",value:function(t){function i(t){return{type:t._type,id:t.id}}var e=this,n={data:{type:this._type}};return t=t||{},t.attributes=t.attributes||this._attributes,t.relationships=t.relationships||this._relationships,void 0!==this.id&&(n.data.id=this.id),0!==t.attributes.length&&(n.data.attributes={}),0!==t.relationships.length&&(n.data.relationships={}),t.attributes.forEach(function(t){n.data.attributes[t]=e[t]}),t.relationships.forEach(function(t){e[t]?e[t].constructor===Array?n.data.relationships[t]={data:e[t].map(i)}:n.data.relationships[t]={data:i(e[t])}:n.data.relationships[t]={data:null}}),n}},{key:"setAttribute",value:function(t,i){void 0===this[t]&&this._attributes.push(t),this[t]=i,this._protectedAttributes[t]=i}},{key:"setRelationship",value:function(t,i){void 0===this[t]&&this._relationships.push(t),this[t]=i,this._protectedRelationships[t]=i}}]),e}(),n=function(){function n(){t(this,n),this.graph={}}return i(n,[{key:"destroy",value:function(t){var i=this;t._references.map(function(e){var n=i.graph[e.type][e.id],r=n[e.relation];r===t?n.setRelationship(e.relation,null):r.constructor===Array&&(i.graph[e.type][e.id][e.relation]=r.filter(function(i){return i!==t}))}),delete i.graph[t._type][t.id]}},{key:"find",value:function(t,i){return this.graph[t]&&this.graph[t][i]?this.graph[t][i]:null}},{key:"findAll",value:function(t){var i=this;return this.graph[t]?Object.keys(i.graph[t]).map(function(e){return i.graph[t][e]}):[]}},{key:"reset",value:function(){this.graph={}}},{key:"initModel",value:function(t,i){return this.graph[t]=this.graph[t]||{},this.graph[t][i]=this.graph[t][i]||new e(t,i),this.graph[t][i]}},{key:"syncRecord",value:function(t){function i(t){if(!a.find(t.type,t.id)){var i=a.initModel(t.type,t.id);i._placeHolder=!0}return a.graph[t.type][t.id]}function n(t){return new e(t.type,t.id)}var r,a=this,s=this.initModel(t.type,t.id);delete s._placeHolder;for(r in t.attributes)-1===s._attributes.indexOf(r)&&s._attributes.push(r),s[r]=t.attributes[r],s._protectedAttributes[r]=t.attributes[r];if(t.links&&(s._links=t.links),t.relationships)for(r in t.relationships){var o,u=t.relationships[r];void 0!==u.data&&(s._relationships.push(r),null===u.data?(s[r]=null,s._protectedRelationships[r]=null):u.data.constructor===Array?(s[r]=[],s._protectedRelationships[r]=[],u.data.forEach(function(t,e){o=i(t),o._references.push({id:s.id,type:s._type,relation:r}),s[r].push(o),s._protectedRelationships[r].push(n(t))})):(o=i(u.data),o._references.push({id:s.id,type:s._type,relation:r}),s[r]=o,s._protectedRelationships[r]=n(u.data))),u.links&&(s._relationship_links=s._relationship_links||{},s._relationship_links[r]=u.links)}return s}},{key:"syncWithMeta",value:function(t){var i=t.data,e=this.syncRecord.bind(this);return i?(t.included&&t.included.map(e),{data:i.constructor===Array?i.map(e):e(i),meta:"meta"in t?t.meta:null}):[]}},{key:"sync",value:function(t){return this.syncWithMeta(t).data}}]),n}();"undefined"!=typeof module&&(module.exports={JsonApiDataStore:n,JsonApiDataStoreModel:e}),exports.JsonApiDataStore=n,exports.JsonApiDataStoreModel=e}();